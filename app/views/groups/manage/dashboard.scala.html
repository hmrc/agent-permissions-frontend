@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import connectors.GroupSummary
@import views.components.models.SummaryListData
@import views.html.main_layout
@import views.html.groups.partials.selectable_clients_table_form
@import views.html.helper.CSPNonce

@this(
    layout: main_layout, p: p, h1: h1, h2: h2, h3: h3, a: a,
    table: table, textbox: textbox, input_select: input_select,
    a_button: link_as_button, summary_list: summary_list, govukTabs: GovukTabs,
    selectable_clients_table_form: selectable_clients_table_form
)

@(
    summaries: (Seq[GroupSummary], Seq[DisplayClient]),
    form: Form[AddClientsToGroup],
    hiddenClientsExist: Option[Boolean],
    showUnassignedClients: Boolean = false
)(implicit request: Request[_], msgs: Messages, appConfig:
AppConfig)

@groupSummaries = {
    @h2("group.manage.tabs.1.label")
    <div class="govuk-!-width-one-third"></div>
    @if(!summaries._1.isEmpty){
        @summaries._1.map { summary =>

            @h3(summary.groupName)
            @summary_list(
                Seq(
                    SummaryListData(
                        "common.clients",
                        summary.clientCount.toString,
                        routes.ManageGroupController.showExistingGroupClients(summary.groupId),
                        linkMsgKey = "group.manage.clients",
                        linkClasses = Some("govuk-!-width-one-half")
                    ),
                    SummaryListData(
                        "common.teamMembers",
                        summary.teamMemberCount.toString,
                        routes.ManageGroupController.showExistingGroupTeamMembers(summary.groupId),
                        linkMsgKey = "group.manage.members",
                        linkClasses = Some("govuk-!-width-one-half")
                    ),
                )
            )
            @a("group.manage.rename",
                href = routes.ManageGroupController.showRenameGroup(summary.groupId).url,
                classes = Some("govuk-!-margin-right-9"))
            @a("group.manage.delete", href = routes.ManageGroupController.showDeleteGroup(summary.groupId).url)
            <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"
            style="height: 3px;
                border-width: 0;
                color: #c6c6c6;
                background-color: #c6c6c6">

        }

    }
    @if(summaries._1.isEmpty){
        @h3("group.manage.no.groups.h3")
    }

    @a_button(key="group.manage.no.groups.button", href=routes.GroupController.showGroupName.url)

}

@unassignedClients = {
    @h2("group.manage.tabs.2.label")

    @if(!summaries._2.isEmpty) {
        @selectable_clients_table_form(
            Some(summaries._2),
            hiddenClientsExist,
            form,
            routes.ManageGroupController.submitAddUnassignedClients
        )

    }
    @if(summaries._2.isEmpty) {
        @h3("group.manage.no.unassigned.clients.h3")
    }

}

@layout(title = msgs("group.manage.h1"),
    backLinkHref = Some(appConfig.agentServicesAccountManageAccountUrl),
    fullWidth = true) {


    @h1("group.manage.h1")
    @p("group.manage.p", classes = Some("govuk-!-margin-bottom-9"), id= Some("info"))

    @govukTabs(Tabs(
        id = Some("manage-groups-tabs"),
        items = Seq(
            TabItem(
                id = Some("groups-panel"),
                label = msgs("group.manage.tabs.1.label"),
                panel = TabPanel(
                    content = HtmlContent(groupSummaries)
                )
            ),
            TabItem(
                id = Some("unassigned-clients"),
                label = msgs("group.manage.tabs.2.label"),
                panel = TabPanel(content = HtmlContent(unassignedClients))
            )
        )
    ))


}
@if(showUnassignedClients){
    <script @{CSPNonce.attr}>
        $(document).ready(function(){
            $(".govuk-tabs__list-item").toggleClass("govuk-tabs__list-item--selected");
            $(".govuk-tabs__panel").toggleClass("govuk-tabs__panel--hidden");
        });
    </script>
}
